# 计算机图形学之渲染管道

[TOC]

## 1. 概述

> 渲染管道：从模型数据到图像生成过程的一种描述
>
> Vertex Shader 能对顶点数据写处理算法，而 Fragment Shader 能对像素数据写处理算法 （都使用GLSL进行编写）

![](https://ws1.sinaimg.cn/large/c3af64f1gy1frubh7qzrbj20ff0l0aab.jpg)

● Application Stage ： 主要是CPU与内存打交道，例如碰撞检测，计算好的数据（顶点坐标、法向量、纹理坐标、纹理）就会通过数据总线传给图形硬件 。

● Geometry Stage（GPU） ：几何阶段，用于处理所有和我们要绘制的几何相关的事情，也被称为**变换和光照阶段**

● Rasterizer Stage：（GPU）

光栅化阶段，利用几何阶段传过来的数据产生像素，并渲染出最终的图像。**指矢量图形转化成像素点的过程 ，指的是连续数据转化为离散数据的过程**.

> 片段是包含了位置，颜色，深度，纹理坐标等属性的数据结构。片段可能会最终成为图像上的像素。



![](https://ws1.sinaimg.cn/large/c3af64f1gy1frubj3mfo9j20lz0d1q5d.jpg)



- **顶点着色器(Vertex Shader)**，它把一个单独的顶点作为输入。顶点着色器主要的目的是把3D坐标转为另一种3D坐标（后面会解释），同时顶点着色器允许我们对顶点属性进行一些基本处理。 
- **图元装配(Primitive Assembly)**阶段将顶点着色器输出的所有顶点作为输入（如果是GL_POINTS，那么就是一个顶点），并所有的点装配成指定图元的形状；本节例子中是一个三角形 
- 图元装配阶段的输出会传递给**几何着色器(Geometry Shader)**。几何着色器把图元形式的一系列顶点的集合作为输入，它可以通过产生新顶点构造出新的（或是其它的）图元来生成其他形状。 
- 几何着色器的输出会被传入光栅化阶段(Rasterization Stage)，这里它会把图元映射为最终屏幕上相应的像素，生成供片段着色器(Fragment Shader)使用的片段(Fragment)。在片段着色器运行之前会执行裁切(Clipping)。裁切会丢弃超出你的视图以外的所有像素，用来提升执行效率。 
- **片段着色器**的主要目的是计算一个像素的最终颜色，这也是所有OpenGL高级效果产生的地方。通常，片段着色器包含3D场景的数据（比如光照、阴影、光的颜色等等），这些数据可以被用来计算最终像素的颜色。 
- **Alpha测试和混合(Blending)阶段**。这个阶段检测片段的对应的深度（和模板(Stencil)）值（后面会讲），用它们来判断这个像素是其它物体的前面还是后面，决定是否应该丢弃。这个阶段也会检查alpha值（alpha值定义了一个物体的透明度）并对物体进行混合(Blend) 。

## 2. 每一部分具体内容

假如我们现在要绘制一个丑陋的箱子，并展示在屏幕上。

1. 程序阶段：通过一系列计算（通常是建模软件导出的），得到一系列的数值点，包括坐标，对应法向量，纹理坐标，纹理

   

2. 几何处理阶段：

   2.1 传入顶点着色器，对每一个顶点做，做一个camera视觉的转换，得到对应的坐标变换。包括 projection * view * model。

   分别是 

   - 投影方式：正交投影, 透视投影

   - view:  camera视角下的变换

   - model在世界坐标系下的线性变换

     

   2.2 图元装配，这些点是draw—points或者draw-line，形成一个几何体。

   

   2.3 几何着色器：对每一个图元执行一次，能够访问图元的所有顶点，以及与其相关的输入变量的值。输入变量都是数组类型.它能够将（这一组）顶点变换为完全不同的图元，并且还能生成比原来更多的顶点。 

   **可以形成大爆炸，粒子系统，瀑布流水等复杂关联的场景。**

   

3. 光栅化阶段：

   3.1 光栅化阶段

   ​	直线的扫描转换：bresenHam 算法， DDA

   ​	扫描线算法

   ​	反走样问题

   3.2 片段着色器

   ​	光照与阴影，纹理。

   3.3 Alpha测试和混合(Blending)阶段：

   ​	alpha测试--透明度

   ​	模板测试--  镜面的反射超过了镜面范围剔除。

   ​	深度测试-- 物体前后关系

   ​	

## 3.总结

其实只是把一些基本概念加深了一下。有机会会继续写关于opengl和图形学相关的内容，包括里面的知识点详解。

不写博客不知道，一写感觉自己忘记了好多。学习加油。ε=( o｀ω′)ノ

## 4. 参考资料

[游戏引擎理论基础](http://www.cnblogs.com/QG-whz/p/4644213.html)

[opengl中文教程](https://learnopengl-cn.github.io/)

[几何着色器](http://www.cnblogs.com/mazhenyu/p/3831986.html)